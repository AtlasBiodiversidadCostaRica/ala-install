- include: ../../common/tasks/setfacts.yml
  tags:
    - biocache-properties

- name: ensure target directories exist
  file: path={{item}} state=directory owner={{tomcat_user}}  group={{tomcat_user}}
  with_items:
    - "{{data_dir}}/biocache/layers"
  tags:
    - biocache-properties    

- name: copy biocache config propeties template 
  template: src={{item}} dest={{data_dir}}/biocache/config/{{item}} owner={{tomcat_user}}  group={{tomcat_user}}  mode=0644
  with_items:
    - biocache-config.properties
  tags:
    - biocache-properties

- name: Download SDS layers
  get_url: url="http://biocache.ala.org.au/archives/layers/sds-layers.tgz" dest="{{data_dir}}/biocache/layers/sds-layers.tgz" force=yes owner={{tomcat_user}} group={{tomcat_user}}
  when: sds_enabled  
  tags:
    - biocache-properties

- name: Extract SDS layers
  shell: "tar zxvf {{data_dir}}/biocache/layers/sds-layers.tgz -C {{data_dir}}/biocache/layers/"
  when: sds_enabled
  tags:
    - biocache-properties

- name: set data ownership [all data is owned by tomcat]
  file: path={{data_dir}}/{{item}} owner={{tomcat_user}} group={{tomcat_user}} recurse=true
  with_items:
    - biocache 
  tags:
    - biocache-properties